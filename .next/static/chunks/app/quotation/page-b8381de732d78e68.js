(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[732],{2627:function(e,t,l){Promise.resolve().then(l.bind(l,9648))},9648:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return c}});var i=l(3955),a=l(2310),r=l(3118),s=l(4380),n=l.n(s),o=l(9985);function c(){let[e,t]=(0,a.useState)([]),[l,s]=(0,a.useState)([]),[c,d]=(0,a.useState)(0),[p,x]=(0,a.useState)("");(0,a.useRef)(),(0,a.useEffect)(()=>{let e=async()=>{let e=await fetch("/api/products",{method:"GET"}),l=await e.json();t(l)};e()},[]),(0,a.useEffect)(()=>{let e=l.reduce((e,t)=>e+(Number(t.price)||0)*t.qty,0);d(e)},[l]);let u=(t,i,a)=>{let r=[...l];if(r[t][i]=a,"title"===i&&"existing"===r[t].type){let l=e.find(e=>e.title===a);r[t].price=(null==l?void 0:l.price)||0}s(r)},h=(e,t)=>{let i=[...l];i[e]={type:t,title:"",price:0,qty:1,specs:"",image:""},s(i)},m=(e,t)=>{let i=new FileReader;i.onload=t=>{let i=[...l];i[e].image=t.target.result,s(i)},i.readAsDataURL(t)},g=async()=>{let t=new r.kH,i=t.internal.pageSize.height,a=i-20,s=new Image;s.src="logo1.png",await new Promise(e=>{s.onload=()=>{let l=25*(s.height/s.width);t.addImage(s,"PNG",10,10,25,l),e()}}),t.setFontSize(12),t.text("Client Name: ".concat(p),14,40),t.text("Date: ".concat(new Date().toLocaleDateString()),150,40);let n=e=>{t.setFillColor(50,50,150),t.rect(10,e-10,190,20,"F"),t.setFont("helvetica","bold"),t.setTextColor(255,255,255),t.text("Title",14,e+5),t.text("Price",50,e+5),t.text("Qty",70,e+5),t.text("Subtotal",90,e+5),t.text("Specs",120,e+5),t.text("Image",160,e+5)};n(60);let o=80,c=0,d=(e,t)=>e.split(/\s+/).map(e=>e.length>t?e.match(RegExp(".{1,".concat(t,"}"),"g")).join("\n"):e).join(" "),x=async t=>{let l=e.find(e=>e.title===t.title),i="string"==typeof(null==l?void 0:l.specifications)?l.specifications:t.specs||"",a=i.replace(/<[^>]*>/g,""),r=d(a,20);return r};for(let i=0;i<l.length;i++){var u,h;let r=l[i],s=i%2==0,d=await x(r),p=t.splitTextToSize(r.title||"",40),m=t.splitTextToSize(d,60),g=6*p.length,b=6*m.length,y=Math.max(25,g,b)+10;o+y>a&&(t.addPage(),n(o=20),o+=20),t.setFillColor(s?230:245,230,245),t.rect(10,o-10,190,y,"F");let f=(Number(r.price)||0)*r.qty;c+=f,t.setFont("helvetica","normal"),t.setTextColor(0,0,0),t.text(p,14,o-5,{baseline:"top"}),t.text((Number(r.price)||0).toFixed(2),50,o),t.text(r.qty.toString(),70,o),t.text(f.toFixed(2),90,o),t.text(m,120,o-5,{baseline:"top",maxWidth:60});let j="existing"===r.type?null===(u=e.find(e=>e.title===r.title))||void 0===u?void 0:null===(h=u.img)||void 0===h?void 0:h[0]:r.image;if(j){let e=new Image;e.src=j,await new Promise(l=>{e.onload=()=>{let i=e.width/e.height,a=25*i;t.addImage(e,"PNG",165,o-5,a,25),l()}})}o+=y}o+10>a&&(t.addPage(),o=20),o+=10,t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("Total Amount: $"+c.toFixed(2),14,o),t.save("quotation.pdf")},b=async()=>{let t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,l="",i="";return e.split(" ").forEach(e=>{i.length+e.length+1>t?(l+=i+"\n",i=e):i+=(i?" ":"")+e}),l+i},i=async l=>{let i=e.find(e=>e.title===l.title),a="string"==typeof(null==i?void 0:i.specifications)?i.specifications:l.specs||"",r=a.replace(/<[^>]*>/g,""),s=t(r,20);return s},a=new(n()).Workbook,r=a.addWorksheet("Quotation");r.columns=[{header:"Title",key:"title",width:20},{header:"Price",key:"price",width:10},{header:"Qty",key:"qty",width:5},{header:"Subtotal",key:"subtotal",width:10},{header:"Specs",key:"specs",width:30}];let s=0;for(let e of l){let t=await i(e),l=(Number(e.price)||0)*e.qty;s+=l,r.addRow({title:e.title,price:(Number(e.price)||0).toFixed(2),qty:e.qty,subtotal:l.toFixed(2),specs:t})}r.getColumn("specs").eachCell((e,t)=>{t>1&&(e.alignment={wrapText:!0})}),r.addRow([]),r.addRow({title:"Total Amount",price:"",qty:"",subtotal:s.toFixed(2),specs:""}),r.getRow(r.lastRow.number).eachCell(e=>{e.font={bold:!0},e.alignment={horizontal:"center"}});let c=await a.xlsx.writeBuffer(),d=new Blob([c],{type:"application/octet-stream"});(0,o.saveAs)(d,"quotation.xlsx")};return(0,i.jsxs)("div",{className:"p-5",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Create Quotation"}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsx)("label",{className:"block font-medium mb-2",children:"Client Name:"}),(0,i.jsx)("input",{type:"text",value:p,onChange:e=>x(e.target.value),className:"w-full border p-2 rounded"})]}),(0,i.jsx)("button",{onClick:()=>{s([...l,{type:"existing",title:"",price:0,qty:1,specs:"",image:""}])},className:"bg-blue-500 text-white px-4 py-2 mb-4 rounded",children:"Add Item"}),(0,i.jsxs)("div",{className:"border p-4",children:[(0,i.jsxs)("table",{className:"table-auto w-full border-collapse border border-gray-300 mb-4",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"border border-gray-300 px-2 py-2",children:"Type"}),(0,i.jsx)("th",{className:"border border-gray-300 px-2 py-2",children:"Title"}),(0,i.jsx)("th",{className:"border border-gray-300 px-2 py-2",children:"Price"}),(0,i.jsx)("th",{className:"border border-gray-300 px-2 py-2",children:"Qty"}),(0,i.jsx)("th",{className:"border border-gray-300 px-2 py-2",children:"Subtotal"}),(0,i.jsx)("th",{className:"border border-gray-300 px-2 py-2",children:"Specs"}),(0,i.jsx)("th",{className:"border border-gray-300 px-2 py-2",children:"Image"})]})}),(0,i.jsx)("tbody",{children:l.map((t,l)=>{var a,r,s;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",name:"type-".concat(l),value:"existing",checked:"existing"===t.type,onChange:()=>h(l,"existing")})," ","Existing"]}),(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",name:"type-".concat(l),value:"custom",checked:"custom"===t.type,onChange:()=>h(l,"custom")})," ","Custom"]})]})}),(0,i.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:"existing"===t.type?(0,i.jsxs)("select",{value:t.title,onChange:e=>u(l,"title",e.target.value),className:"w-full border-none p-1 outline-none",children:[(0,i.jsx)("option",{value:"",children:"Select Product"}),e.map(e=>(0,i.jsx)("option",{value:e.title,children:e.title},e.title))]}):(0,i.jsx)("input",{type:"text",value:t.title,onChange:e=>u(l,"title",e.target.value),className:"w-full border-none p-1 outline-none",placeholder:"Enter Title"})}),(0,i.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:(0,i.jsx)("input",{type:"number",value:t.price,onChange:e=>u(l,"price",e.target.value),className:"w-full border-none p-1 outline-none"})}),(0,i.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:(0,i.jsx)("input",{type:"number",value:t.qty,onChange:e=>u(l,"qty",e.target.value),className:"w-full border-none p-1 outline-none"})}),(0,i.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:"$".concat(((Number(t.price)||0)*t.qty).toFixed(2))}),(0,i.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:"existing"===t.type?(0,i.jsx)("ul",{className:"list-disc pl-4",children:(null===(a=e.find(e=>e.title===t.title))||void 0===a?void 0:a.specifications)?(0,i.jsx)("li",{dangerouslySetInnerHTML:{__html:e.find(e=>e.title===t.title).specifications}}):(0,i.jsx)("span",{className:"text-gray-500",children:"No specifications available"})}):(0,i.jsx)("textarea",{value:t.specs,onChange:e=>u(l,"specs",e.target.value),className:"w-full border-none p-1 outline-none",rows:2})}),(0,i.jsx)("td",{className:"border border-gray-300 px-2 py-2",children:"existing"===t.type&&(null===(r=e.find(e=>e.title===t.title))||void 0===r?void 0:null===(s=r.img)||void 0===s?void 0:s[0])?(0,i.jsx)("img",{src:"api/proxy?url=".concat(e.find(e=>e.title===t.title).img[0]),alt:"Product",className:"mt-2 max-w-full h-16"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:e=>m(l,e.target.files[0])}),t.image&&(0,i.jsx)("img",{src:t.image,alt:"Uploaded",className:"mt-2 max-w-full h-16"})]})})]},l)})})]}),(0,i.jsx)("div",{className:"flex justify-between items-center",children:(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Total:"})," ","$".concat(c.toFixed(2))]})})]}),(0,i.jsx)("button",{onClick:g,className:"bg-red-500 text-white px-4 py-2 rounded mr-4",children:"Export to PDF"}),(0,i.jsx)("button",{onClick:b,className:"bg-green-500 text-white px-4 py-2 rounded",children:"Export to Excel"})]})}}},function(e){e.O(0,[546,607,553,704,801,744],function(){return e(e.s=2627)}),_N_E=e.O()}]);